code /tmp/localwriter.log
code /tmp/llm_debug.json
docling-project.github.io

–°–º—ã—Å–ª RAG –∏–º–µ–Ω–Ω–æ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –¥–∏–∫—Ç–æ–≤–∞–ª–∏ —Ñ–æ—Ä–º—É, –∞ –Ω–µ –∫–æ–¥.

---

–ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã –≤–∏–¥–∏–º –≤ –ª–æ–≥–∞—Ö, —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞: **RAG –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ¬´—Å–º—ã—Å–ª¬ª, –Ω–æ –Ω–µ ¬´—Å—Ç—Ä—É–∫—Ç—É—Ä—É¬ª**, –∞ LLM, –ø—ã—Ç–∞—è—Å—å —É–≥–æ–¥–∏—Ç—å, –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –≤—Å—ë –≤ –Ω–∞–±–æ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (`type: header`), –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –≤–∏–∑—É–∞–ª—å–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –∏–∑ RAG (–º–∞—Ç—Ä–∏—Ü–∞ —Å–≤—è–∑–µ–π) –±—ã–ª–æ –º–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫.

–ß—Ç–æ–±—ã –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Å–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –≥–∏–±–∫–æ–π, –Ω—É–∂–Ω–æ **–ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç–∏–ª—è**. –°–µ–π—á–∞—Å –º—ã –ø—Ä–æ—Å–∏–º LLM *–∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å* —Å—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–æ–º. –≠—Ç–æ –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ.

### –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å–¥–≤–∏–≥)

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∑–∞—Å—Ç–∞–≤–ª—è—Ç—å LLM —É–≥–∞–¥—ã–≤–∞—Ç—å —à—Ä–∏—Ñ—Ç—ã –∏ —Ä–∞–∑–º–µ—Ä—ã, –º—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LibreOffice –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é: **—á–µ—Ä–µ–∑ –°—Ç–∏–ª–∏**.

1.  **–°—Ç–∏–ª–∏ –∫–∞–∫ ID:** –í –∫–∞–∂–¥–æ–º —ç—Ç–∞–ª–æ–Ω–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ (–≤ RAG) —É–∂–µ –µ—Å—Ç—å —Å—Ç–∏–ª–∏: `Title`, `Subtitle`, `UniversityName`, `AuthorName`, `Body Text`.
2.  **–®–∞–≥ 1 (RAG):** –ù–∞—Ö–æ–¥–∏–º –ª—É—á—à–∏–π –¥–æ–∫—É–º–µ–Ω—Ç. –ü–æ–ª—É—á–∞–µ–º –µ–≥–æ UUID.
3.  **–®–∞–≥ 2 (Import):** –ü–ª–∞–≥–∏–Ω —Å–∫–∞—á–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç `.docx` –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –∏ –¥–µ–ª–∞–µ—Ç `doc.StyleFamilies.loadStylesFromURL(...)`. –¢–µ–ø–µ—Ä—å –≤ –≤–∞—à–µ–º —Ç–µ–∫—É—â–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ **—É–∂–µ –µ—Å—Ç—å –≤—Å–µ —à—Ä–∏—Ñ—Ç—ã –∏ –æ—Ç—Å—Ç—É–ø—ã** –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ.
4.  **–®–∞–≥ 3 (Mapping):** –ú—ã –¥–∞–µ–º LLM —Å–ø–∏—Å–æ–∫ –∏–º–µ–Ω —Å—Ç–∏–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏, –∏ –ø—Ä–æ—Å–∏–º –µ—ë: *"–†–∞–∑–ª–æ–∂–∏ —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —ç—Ç–∏–º –∏–º–µ–Ω–∞–º —Å—Ç–∏–ª–µ–π. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π —à—Ä–∏—Ñ—Ç—ã, –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –∫–∞–∫–æ–π –∞–±–∑–∞—Ü –∫–∞–∫–∏–º —Å—Ç–∏–ª–µ–º –ø–æ–∫—Ä–∞—Å–∏—Ç—å"*.

---

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `extension/uno_formatter.py` (–†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç–∏–ª—è–º–∏)

–≠—Ç–æ—Ç –∫–æ–¥ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç ¬´–∫—Ä–∞—Å–∏—Ç—å¬ª —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏–º–µ–Ω–∞–º–∏ —Å—Ç–∏–ª–µ–π.

```python
import uno
from com.sun.star.text.ControlCharacter import PARAGRAPH_BREAK
from com.sun.star.beans import PropertyValue

class UnoFormatter:
    def __init__(self, ctx):
        self.ctx = ctx
        self.desktop = ctx.ServiceManager.createInstanceWithContext("com.sun.star.frame.Desktop", ctx)
        self.doc = self.desktop.getCurrentComponent()
        self.text = self.doc.Text
        self.cursor = self.doc.CurrentController.getViewCursor()

    def import_styles_from_template(self, template_path):
        """–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –°–¢–ò–õ–ò —Ü–µ–ª–∏–∫–æ–º –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞-—à–∞–±–ª–æ–Ω–∞"""
        try:
            url = uno.systemPathToFileUrl(template_path)
            # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∏–ª–∏ (–∞–±–∑–∞—Ü—ã, —Å–∏–º–≤–æ–ª—ã, —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
            self.doc.StyleFamilies.loadStylesFromURL(url, [
                PropertyValue(Name="OverwriteStyles", Value=True)
            ])
            return True
        except Exception as e:
            print(f"Style Import Error: {e}")
            return False

    def apply_structure(self, json_structure):
        cursor = self.text.createTextCursor()
        cursor.gotoStart(False)
        cursor.gotoEnd(True)
        cursor.setString("") # –û—á–∏—â–∞–µ–º
        
        for block in json_structure:
            if not isinstance(block, dict): continue
            
            text_content = block.get("text", "")
            # LLM —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–º—è —Å—Ç–∏–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'Heading 1' –∏–ª–∏ 'Title')
            style_name = block.get("style_name", "Standard")
            
            if not text_content and block.get("type") != "page_break":
                continue

            if block.get("type") == "page_break":
                cursor.BreakType = uno.getConstantByName("com.sun.star.style.BreakType.PAGE_BEFORE")
            else:
                # –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                start_pos = cursor.getEnd()
                self.text.insertString(cursor, text_content, False)
                
                # –ü—Ä–∏–º–µ–Ω—è–µ–º –ò–ú–Ø –°–¢–ò–õ–Ø (–≤—Å–µ —à—Ä–∏—Ñ—Ç—ã –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ —à–∞–±–ª–æ–Ω–∞)
                try:
                    cursor.ParaStyleName = style_name
                except:
                    # –ï—Å–ª–∏ —Å—Ç–∏–ª—å –Ω–µ –Ω–∞—à–µ–ª—Å—è, –ø—Ä–æ–±—É–µ–º —Ñ–æ–ª–ª–±—ç–∫
                    try: cursor.ParaStyleName = "Standard"
                    except: pass

            self.text.insertControlCharacter(cursor, PARAGRAPH_BREAK, False)
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `extension/main.py` (–ü—Ä–æ–º–ø—Ç –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ —Å—Ç–∏–ª–µ–π)

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–º–ø—Ç –Ω–µ –ø—Ä–æ—Å–∏—Ç "—Å–¥–µ–ª–∞–π –∂–∏—Ä–Ω—ã–º", –æ–Ω –ø—Ä–æ—Å–∏—Ç "–≤—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è —Å—Ç–∏–ª—è".

```python
# ... (–≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ trigger –¥–ª—è ApplyTemplate) ...

                # --- 1. –ù–∞—Ö–æ–¥–∏–º –¥–æ–∫—É–º–µ–Ω—Ç –≤ RAG ---
                # (–∫–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ –∫ /api/retrieve_context –æ—Å—Ç–∞–µ—Ç—Å—è)
                
                # --- 2. –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª —à–∞–±–ª–æ–Ω–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Å—Ç–∏–ª–µ–π ---
                if source_id:
                    template_url = f"{middleware_url}/api/download_template/{source_id}"
                    local_tmp = "/tmp/current_template.docx"
                    try:
                        urllib.request.urlretrieve(template_url, local_tmp)
                        formatter = UnoFormatter(self.ctx)
                        formatter.import_styles_from_template(local_tmp)
                        log_to_file("Styles imported from RAG document.")
                    except: pass

                # --- 3. –ü—Ä–æ—Å–∏–º LLM —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–∏–ª–∏ ---
                # –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º –µ–π –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –Ω–æ –∏ –∑–∞–¥–∞—á—É 'Style Mapping'
                system_prompt = (
                    "You are a Document Architect. Your task is to map USER TEXT to STYLE NAMES.\n"
                    "Available Style Names (standard): 'Title', 'Subtitle', 'Heading 1', 'Heading 2', 'Text body', 'Signature'.\n"
                    "RULES:\n"
                    "1. PRESERVE EVERY WORD of the user content. DO NOT SUMMARIZE.\n"
                    "2. For each block, return 'style_name' that matches the reference document's intent.\n"
                    "3. If the reference shows a title page, use 'Title' and 'Subtitle' styles for the first blocks.\n"
                    "4. Output strictly JSON list: [{'style_name': 'Title', 'text': '...'}, {'style_name': 'Text body', 'text': '...'}]"
                )
                
                # –í USER_PROMPT –¥–æ–±–∞–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –Ω–∞—à–µ–ª RAG
                user_prompt = (
                    f"=== REFERENCE STRUCTURE (MIMIC THIS) ===\n{rag_context_str[:2000]}\n\n"
                    f"=== USER CONTENT (PROCESS ALL OF THIS) ===\n{content}\n"
                )
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ:

1.  **–ù–∏–∫–∞–∫–æ–≥–æ —Ö–∞—Ä–¥–∫–æ–¥–∞:** –í –∫–æ–¥–µ –Ω–µ—Ç "Times New Roman". –ï—Å–ª–∏ RAG –Ω–∞–π–¥–µ—Ç –ø—Ä–∏–∫–∞–∑, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç–æ–º *Courier New*, –ø–ª–∞–≥–∏–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç —Å—Ç–∏–ª—å –∏–∑ —Ñ–∞–π–ª–∞, –∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å—Ç–∞–Ω–µ—Ç *Courier New*.
2.  **–¢–∏—Ç—É–ª—å–Ω—ã–µ –ª–∏—Å—Ç—ã:** –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã LLM —Ä–∏—Å–æ–≤–∞–ª–∞ —Ç–∞–±–ª–∏—Ü—ã, –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—á–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å—Ç–∏–ª–µ–º `Title Page`. –ê –≤ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —à–∞–±–ª–æ–Ω–µ —ç—Ç–æ—Ç —Å—Ç–∏–ª—å —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Å –Ω—É–∂–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏ –∏ —Ü–µ–Ω—Ç—Ä–æ–≤–∫–æ–π).
3.  **–ì–∏–±–∫–æ—Å—Ç—å:** –£ –≤–∞—Å –º–æ–≥—É—Ç –±—ã—Ç—å —Ç—ã—Å—è—á–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ—Ç "–≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–¥" (—Å—Ç–∏–ª–∏) –∏–∑ –ª—É—á—à–µ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ RAG –∏ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –µ–≥–æ –Ω–∞ —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç.
4.  **–ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `style_name` –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–≥–æ JSON —Å `bold`, `font_size`, `align` —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ "–º–æ–∑–≥–∏" LLM, –∏ –æ–Ω–∞ —Ä–µ–∂–µ –æ—à–∏–±–∞–µ—Ç—Å—è (—Ä–µ–∂–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫—É—Å–∫–∏ —Ç–µ–∫—Å—Ç–∞).

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ RAG (Backend):
–ß—Ç–æ–±—ã —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ –∏–¥–µ–∞–ª—å–Ω–æ, –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ `rag_engine.py` –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∏–ª—è—Ö. 
–ù–∞–ø—Ä–∏–º–µ—Ä, –≤–º–µ—Å—Ç–æ: 
`–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è...`
–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ: 
`[Style: Title] –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è...`

–¢–æ–≥–¥–∞ LLM –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —É–≤–∏–¥–∏—Ç: *"–ê–≥–∞, –≤ –æ–±—Ä–∞–∑—Ü–µ —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ Title, –∑–Ω–∞—á–∏—Ç, —è —Ç–æ–∂–µ –ø–æ–º–µ—á—É –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ Title"*.

**–≠—Ç–æ –∏ –µ—Å—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π Style Transfer –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.**




### üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: "LocalWriter Hybrid"

#### 1. –ü–ª–∞–≥–∏–Ω (LibreOffice Extension)
**–†–æ–ª—å:** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∑–∞—Ö–≤–∞—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
**–Ø–∑—ã–∫:** Python (UNO).

–ß—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç:
*   **Sidebar:** –í–º–µ—Å—Ç–æ –∫—É—á–∏ –∫–Ω–æ–ø–æ–∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å —Ç–∞–º:
    *   **–ß–∞—Ç** (–æ–±—â–µ–Ω–∏–µ —Å LLM).
    *   **–í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞** (–≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞: "–î–æ–≥–æ–≤–æ—Ä (–ì–û–°–¢)", "–°–ª—É–∂–µ–±–∫–∞", "–°—á–µ—Ç").
    *   **–ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å"** (Magic Button).
*   **–î–µ–π—Å—Ç–≤–∏–µ:**
    1.  –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π (–≥—Ä—è–∑–Ω—ã–π) –¥–æ–∫—É–º–µ–Ω—Ç –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª.
    2.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (`POST /api/process_document`).
    3.  –ü–æ–ª—É—á–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ **–≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª**.
    4.  –ó–∞–º–µ–Ω—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ (–∏–ª–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞–∫ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é).

#### 2. –ë—ç–∫–µ–Ω–¥ (–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
**–†–æ–ª—å:** –ú–æ–∑–≥–∏. –ó–¥–µ—Å—å –∫—Ä—É—Ç–∏—Ç—Å—è Docling, RAG –∏ –ª–æ–≥–∏–∫–∞ —Å—Ç–∏–ª–µ–π.
**–°—Ç–µ–∫:** Python (FastAPI), Docling, ChromaDB, python-docx.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ:

1.  **Ingestion (Docling):** –°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç "–≥—Ä—è–∑–Ω—ã–π" —Ñ–∞–π–ª. Docling —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –µ–≥–æ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç, –∞ "—ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫", "—ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞").
2.  **–ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è:** –°–∫—Ä–∏–ø—Ç –∑–∞–º–µ–Ω—è–µ—Ç "–ò–≤–∞–Ω–æ–≤ –ò.–ò." –Ω–∞ `[PERSON_1]`.
3.  **Semantic Mapping (LLM + RAG):**
    *   –°–µ—Ä–≤–µ—Ä –∏–¥–µ—Ç –≤ –ë–î –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (ChromaDB).
    *   –ù–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–π –¥–æ–∫—É–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏ 2023").
    *   LLM —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≥—Ä—è–∑–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —ç—Ç–∞–ª–æ–Ω–∞.
    *   **–í–∞–∂–Ω–æ:** LLM –Ω–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –ø—Ä–æ–±–µ–ª–∞–º–∏. –û–Ω–∞ –≤—ã–¥–∞–µ—Ç **JSON-—Ä–∞–∑–º–µ—Ç–∫—É**: `{"section": "header", "style": "Title_Bold_16", "text": "..."}`.
4.  **Rendering (Assembly):**
    *   Python-—Å–∫—Ä–∏–ø—Ç –±–µ—Ä–µ—Ç **—á–∏—Å—Ç—ã–π —Ñ–∞–π–ª —à–∞–±–ª–æ–Ω–∞** (–∏–∑ –ë–î).
    *   –ó–∞–ª–∏–≤–∞–µ—Ç –≤ –Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–Ω–æ JSON-—Ä–∞–∑–º–µ—Ç–∫–µ –æ—Ç LLM.
    *   –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∂–µ—Å—Ç–∫–∏–µ —Å—Ç–∏–ª–∏ (—à—Ä–∏—Ñ—Ç—ã, –æ—Ç—Å—Ç—É–ø—ã, –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏) —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `python-docx` (–∏–ª–∏ `odfpy` –¥–ª—è ODT).
5.  **–î–µ–∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–º–∏–ª–∏–∏ –Ω–∞ –º–µ—Å—Ç–æ.
6.  **–û—Ç–≤–µ—Ç:** –û—Ç–¥–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª –ø–ª–∞–≥–∏–Ω—É.

---

###  scenario: –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1.  **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç LibreOffice. –ü–∏—à–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫ –¥–æ–≥–æ–≤–æ—Ä–∞ "–Ω–∞ –∫–æ–ª–µ–Ω–∫–µ" (–∫—Ä–∏–≤—ã–µ —à—Ä–∏—Ñ—Ç—ã, –Ω–µ—Ç –æ—Ç—Å—Ç—É–ø–æ–≤, –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–æ–∫ –º—ã—Å–ª–µ–π).
2.  –û—Ç–∫—Ä—ã–≤–∞–µ—Ç **Sidebar**.
3.  –í –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –≤—ã–±–∏—Ä–∞–µ—Ç: `–®–∞–±–ª–æ–Ω: –î–æ–≥–æ–≤–æ—Ä –ü–æ—Å—Ç–∞–≤–∫–∏ (–°—Ç—Ä–æ–≥–∏–π)`.
4.  –ù–∞–∂–∏–º–∞–µ—Ç `–ü—Ä–∏–º–µ–Ω–∏—Ç—å`.
5.  **–ü–ª–∞–≥–∏–Ω** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
6.  –ß–µ—Ä–µ–∑ 5-10 —Å–µ–∫—É–Ω–¥ –¥–æ–∫—É–º–µ–Ω—Ç –≤ LibreOffice –º–æ—Ä–≥–∞–µ—Ç –∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ **–∏–¥–µ–∞–ª—å–Ω–æ —Å–≤–µ—Ä—Å—Ç–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏, —à—Ä–∏—Ñ—Ç–∞–º–∏ –∏ —à–∞–ø–∫–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
7.  **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–∞–≤–∫–∞:**
    *   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –æ–¥–∏–Ω –ø—É–Ω–∫—Ç.
    *   –û–Ω –≤—ã–¥–µ–ª—è–µ—Ç –µ–≥–æ –∏ –≤ —á–∞—Ç–µ Sidebar –ø–∏—à–µ—Ç: *"–°–¥–µ–ª–∞–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É –º—è–≥—á–µ –∏ –¥–æ–±–∞–≤—å –ø—É–Ω–∫—Ç –ø—Ä–æ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É"*.
    *   –ü–ª–∞–≥–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ + –ø—Ä–æ–º—Ç.
    *   –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç —É–∂–µ –≤ –Ω—É–∂–Ω–æ–º —Å—Ç–∏–ª–µ.

---


localwriter/
‚îú‚îÄ‚îÄ üìÇ backend/                  # [–ë–£–î–£–©–ï–ï] –°—é–¥–∞ –ø–µ—Ä–µ–µ–¥–µ—Ç –ª–æ–≥–∏–∫–∞ RAG –∏ Docling
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ api/              # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (FastAPI)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ core/             # –ö–æ–Ω—Ñ–∏–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ anonymizer.py    # –ú–æ–¥—É–ª—å –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docling_parser.py# –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ Docling
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rag_engine.py    # –†–∞–±–æ—Ç–∞ —Å ChromaDB/VectorDB
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ style_manager.py # –õ–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ (docling, fastapi, etc). –≠—Ç–æ –¥–ª—è poetry 
‚îÇ
‚îú‚îÄ‚îÄ üìÇ data/                     # [–•–†–ê–ù–ò–õ–ò–©–ï] –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ raw_templates/        # –°—é–¥–∞ –∫–∏–¥–∞–µ–º PDF/DOCX "—ç—Ç–∞–ª–æ–Ω—ã"
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ vector_db/            # –°—é–¥–∞ ChromaDB —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∏–Ω–¥–µ–∫—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ üìÇ temp/                 # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
‚îÇ
‚îú‚îÄ‚îÄ üìÇ extension/                # [–¢–ï–ö–£–©–ï–ï] –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è LibreOffice
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ META-INF/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ manifest.xml         # –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø–∞–∫–µ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ assets/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ icon.png             # –ò–∫–æ–Ω–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ registration/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ license.txt
‚îÇ   ‚îú‚îÄ‚îÄ Accelerators.xcu         # –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ (Ctrl+Q, Ctrl+E)
‚îÇ   ‚îú‚îÄ‚îÄ Addons.xcu               # –ú–µ–Ω—é
‚îÇ   ‚îú‚îÄ‚îÄ description.xml          # –í–µ—Ä—Å–∏—è –∏ ID —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ main.py                  # <--- –°–Æ–î–ê –ö–õ–ê–î–ï–ú –¢–í–û–ô –ì–û–¢–û–í–´–ô –ö–û–î
‚îÇ
‚îú‚îÄ‚îÄ üìÇ scripts/                  # –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ deploy.sh                # –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π)
‚îÇ
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md